{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://antigravity-os.dev/schemas/activity-log.json",
  "title": "Activity Log Entry Schema",
  "description": "JSON Schema for Activity Log entry validation",
  "type": "object",
  "required": ["timestamp", "taskId", "category", "status", "details"],
  "properties": {
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of the log entry"
    },
    "taskId": {
      "type": "string",
      "minLength": 1,
      "description": "Unique task identifier"
    },
    "category": {
      "type": "string",
      "enum": ["task", "error", "validation", "self-healing"],
      "description": "Category of the log entry"
    },
    "status": {
      "type": "string",
      "enum": ["success", "failure", "pending", "skipped"],
      "description": "Status of the operation"
    },
    "details": {
      "type": "object",
      "required": ["description"],
      "properties": {
        "description": {
          "type": "string",
          "minLength": 1,
          "description": "Detailed description of the operation"
        },
        "validationResults": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/ValidationResult"
          },
          "description": "Validation results (if applicable)"
        },
        "errorContext": {
          "type": "object",
          "properties": {
            "message": {
              "type": "string"
            },
            "stack": {
              "type": "string"
            },
            "code": {
              "type": "string"
            },
            "file": {
              "type": "string"
            },
            "line": {
              "type": "number"
            }
          },
          "description": "Error context (if applicable)"
        },
        "corrections": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["type", "description", "before", "after", "timestamp"],
            "properties": {
              "type": {
                "type": "string",
                "enum": ["spec-update", "code-fix", "config-change"]
              },
              "description": {
                "type": "string"
              },
              "before": {
                "type": "string"
              },
              "after": {
                "type": "string"
              },
              "timestamp": {
                "type": "string",
                "format": "date-time"
              }
            }
          },
          "description": "Corrections applied (if applicable)"
        }
      },
      "description": "Detailed information about the operation"
    },
    "metadata": {
      "type": "object",
      "description": "Additional metadata"
    }
  },
  "definitions": {
    "ValidationResult": {
      "type": "object",
      "required": ["passed", "evidence", "confidence", "duration", "timestamp"],
      "properties": {
        "passed": {
          "type": "boolean",
          "description": "Whether validation passed"
        },
        "evidence": {
          "type": "string",
          "description": "Evidence supporting the validation result"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Confidence score (0-100)"
        },
        "duration": {
          "type": "number",
          "minimum": 0,
          "description": "Duration in milliseconds"
        },
        "timestamp": {
          "type": "string",
          "format": "date-time",
          "description": "ISO 8601 timestamp"
        },
        "error": {
          "type": "string",
          "description": "Error message (if validation failed)"
        }
      }
    }
  }
}
